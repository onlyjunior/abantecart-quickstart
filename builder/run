#!/bin/bash

set -x

set -eo pipefail

cp -Rf /opt/app-root/downloads/* /opt/app-root/src/

if grep -q SERVER_NAME system/config.php; [ $? -eq 1 ]; then    
    php system/cli_install.php install \
        --db_host=$MYSQL_HOST \
        --db_user=$MYSQL_USER \
        --db_password=$MYSQL_PASSWORD \
        --db_name=$MYSQL_DATABASE \
        --db_driver=mysqli \
        --db_prefix=abc \
        --admin_path=admin \
        --username=admin \
        --password=admin \
        --email=mail@mail.com \
        --http_server=http://localhost

fi


# if [ -f /opt/app-root/downloads/system ]; then
#     cp -f /opt/app-root/downloads/system/* system
# fi

# if [ -f /opt/app-root/downloads/image ]; then
    # cp -f /opt/app-root/downloads/image/* image
# fi

# if [ -f /opt/app-root/downloads/download ]; then
    # cp -f /opt/app-root/downloads/download/* download
# fi

# if [ -f /opt/app-root/downloads/extensions ]; then
#     cp -f /opt/app-root/downloads/extensions/* extensions
# fi

# if [ -f /opt/app-root/downloads/resources ]; then
    # cp -f /opt/app-root/downloads/resources/* resources
# fi


exec /usr/libexec/s2i/run
